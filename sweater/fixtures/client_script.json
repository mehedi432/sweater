[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset",
  "enabled": 1,
  "modified": "2025-07-29 15:27:44.006534",
  "module": null,
  "name": "ASSET CUSTONIAN FIELD FULL NAME",
  "script": "frappe.ui.form.on('Asset', {\r\n    custodian: function(frm) {\r\n        if (frm.doc.custodian) {\r\n            frappe.call({\r\n                method: \"frappe.client.get\",\r\n                args: {\r\n                    doctype: \"Employee\",\r\n                    name: frm.doc.custodian\r\n                },\r\n                callback: function(r) {\r\n                    if (r.message) {\r\n                        let emp = r.message;\r\n                        let display = `${emp.employee_number || ''} - ${emp.employee_name || emp.employee || ''}`;\r\n                        frm.set_value('custodian_details', display);\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            frm.set_value('custodian_details', '');\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Daily Sample Request",
  "enabled": 1,
  "modified": "2025-11-13 01:21:50.614833",
  "module": "Sweater",
  "name": "AUTO FILL THE PROCESS TYPE",
  "script": "frappe.ui.form.on('Daily Sample Request', {\n    refresh(frm) {\n        // Add button on form\n        frm.add_custom_button('Create Sample Work Order', () => {\n            if (!frm.doc.name) {\n                frappe.msgprint(__('Please save the Daily Sample Request first.'));\n                return;\n            }\n\n            // Create new Sample Work Order with link field prefilled\n            frappe.new_doc('Sample Work Order', {\n                fetch_daily_sample_request: frm.doc.name\n            });\n        }, __('Actions')); // optional group label for better UI\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sample Work Order",
  "enabled": 1,
  "modified": "2025-09-13 22:51:24.741075",
  "module": null,
  "name": "AUTO FILL PROCESS TYPE",
  "script": "frappe.ui.form.on('Sample Work Order', {\n    onload(frm) {\n        const processTypeMap = {\n            \"Design\": \"Pre-Production\",\n            \"Program\": \"Pre-Production\",\n            \"Knitting\": \"Production\",\n            \"Knitting Manual\": \"Production\",\n            \"Linking\": \"Production\",\n            \"Mending\": \"Production\",\n            \"Wash\": \"Post-Production\",\n            \"Print\": \"Post-Production\",\n            \"Iron\": \"Post-Production\",\n            \"Sewing\": \"Post-Production\",\n            \"Zip / Button\": \"Post-Production\",\n            \"Finishing\": \"Post-Production\"\n        };\n\n        // On load: auto fill process_type if it's empty\n        (frm.doc.workstation_details || []).forEach(row => {\n            if (row.process_name && !row.process_type) {\n                row.process_type = processTypeMap[row.process_name] || '';\n            }\n        });\n\n        frm.refresh_field('workstation_details');\n    }\n});\n\nfrappe.ui.form.on('Workstation Details', {\n    process_name: function(frm, cdt, cdn) {\n        const row = locals[cdt][cdn];\n        const processTypeMap = {\n            \"Design\": \"Pre-Production\",\n            \"Program\": \"Pre-Production\",\n            \"Knitting\": \"Production\",\n            \"Knitting Manual\": \"Production\",\n            \"Linking\": \"Production\",\n            \"Mending\": \"Production\",\n            \"Wash\": \"Post-Production\",\n            \"Print\": \"Post-Production\",\n            \"Iron\": \"Post-Production\",\n            \"Sewing\": \"Post-Production\",\n            \"Zip / Button\": \"Post-Production\",\n            \"Finishing\": \"Post-Production\"\n        };\n\n        if (row.process_name) {\n            row.process_type = processTypeMap[row.process_name] || '';\n            frm.refresh_field('workstation_details');\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Order Sheet Entry",
  "enabled": 1,
  "modified": "2025-11-25 23:11:58.794912",
  "module": "Sweater Merchandising",
  "name": "AUTO CALCULATE ORDER SHEET QUANTITY",
  "script": "\nfrappe.ui.form.on(\"Order Sheet Entry\", {\n\n    refresh(frm) {\n        calculate_totals(frm);\n    },\n\n    qty_details_add(frm) {\n        sync_qty_to_yarn(frm);\n    },\n\n    qty_details_remove(frm) {\n        sync_qty_to_yarn(frm);\n    }\n\n});\n\nfunction sync_qty_to_yarn(frm) {\n    let qty_rows = frm.doc.qty_details || [];\n    let yarn_rows = frm.doc.yarn_details || [];\n\n    // Keep track of sizes we have processed\n    let processed_sizes = [];\n\n    qty_rows.forEach(qty_row => {\n        let yarn_row = yarn_rows.find(r => r.size === qty_row.size);\n\n        if(!yarn_row) {\n            yarn_row = frm.add_child(\"yarn_details\");\n            yarn_row.size = qty_row.size;\n        }\n\n        processed_sizes.push(qty_row.size);\n\n        // Update quantity using frappe.model.set_value\n        frappe.model.set_value(yarn_row.doctype, yarn_row.name, \"quantity\", flt(qty_row.qty));\n\n        // Calculate total_yarn\n        let consumption = flt(yarn_row.consumption_per_pcs || 0);\n        let wastage = flt(yarn_row.wastage || 0);\n        frappe.model.set_value(yarn_row.doctype, yarn_row.name, \"total_yarn\", (consumption * flt(qty_row.qty)) * (1 + wastage / 100));\n    });\n\n    // Remove any yarn_details rows that are no longer in qty_details\n    yarn_rows.forEach(row => {\n        if(!processed_sizes.includes(row.size)) {\n            frappe.model.delete_doc(row.doctype, row.name);\n        }\n    });\n\n    frm.refresh_field(\"yarn_details\");\n    calculate_totals(frm);\n}\n\nfunction calculate_totals(frm) {\n    let total_yarn = 0;\n    let total_qty = 0;\n\n    (frm.doc.yarn_details || []).forEach(row => {\n        total_yarn += flt(row.total_yarn);\n        total_qty += flt(row.quantity);\n    });\n\n    frm.set_value(\"total_required_yarn\", total_yarn);\n    frm.set_value(\"sweater_quantity\", total_qty);\n}\n\n\n// Parent Doctype Trigger\nfrappe.ui.form.on(\"Order Sheet Qty Detail\", {\n\n    qty(frm, cdt, cdn) {\n        sync_qty_to_yarn(frm);\n    },\n\n    size(frm, cdt, cdn) {\n        sync_qty_to_yarn(frm);\n    }\n\n});\n\nfunction sync_qty_to_yarn(frm) {\n    let qty_rows = frm.doc.qty_details || [];\n    let yarn_rows = frm.doc.yarn_details || [];\n\n    let processed_sizes = [];\n\n    qty_rows.forEach(qty_row => {\n        // Try to find an existing yarn_details row with the same size\n        let yarn_row = yarn_rows.find(r => r.size === qty_row.size);\n\n        if (!yarn_row) {\n            // Create new row if it doesn't exist\n            yarn_row = frm.add_child(\"yarn_details\");\n            yarn_row.size = qty_row.size;\n        }\n\n        processed_sizes.push(qty_row.size);\n\n        // Update quantity in yarn_details\n        frappe.model.set_value(yarn_row.doctype, yarn_row.name, \"quantity\", flt(qty_row.qty));\n\n        // Calculate total_yarn based on existing consumption and wastage\n        let consumption = flt(yarn_row.consumption_per_pcs || 0);\n        let wastage = flt(yarn_row.wastage || 0);\n        frappe.model.set_value(yarn_row.doctype, yarn_row.name, \"total_yarn\", (consumption * flt(qty_row.qty)) * (1 + wastage / 100));\n    });\n\n    // Optional: remove yarn_details rows not in qty_details\n    // yarn_rows.forEach(row => {\n    //     if (!processed_sizes.includes(row.size)) frappe.model.delete_doc(row.doctype, row.name);\n    // });\n\n    frm.refresh_field(\"yarn_details\");\n\n    // Optional: recalc parent totals if you have calculate_totals function\n    if(typeof calculate_totals === \"function\") {\n        calculate_totals(frm);\n    }\n}\n// Parent Doctype Trigger\nfrappe.ui.form.on(\"Order Sheet Entry\", {\n    total_required_yarn(frm) {\n        calculate_colour_totals(frm);\n    }\n});\n\n// Child Table Triggers\nfrappe.ui.form.on(\"Multiple Colour Ratio\", {\n    percentage(frm, cdt, cdn) {\n        calculate_colour_totals(frm);\n    },\n    weight(frm, cdt, cdn) {\n        calculate_colour_totals(frm);\n    }\n});\n\n// Main Calculation Function\nfunction calculate_colour_totals(frm) {\n    const child = frm.doc.multiple_colour_ratio;\n    if (!child || child.length === 0) return;\n\n    let total_required = flt(frm.doc.total_required_yarn); // in grams\n\n    // Sum of percentages\n    let total_percentage = 0;\n    child.forEach(row => {\n        total_percentage += flt(row.percentage);\n    });\n\n    let sum_qty = 0;\n\n    // Calculate all except last row\n    for (let i = 0; i < child.length; i++) {\n        let row = child[i];\n        let perc = flt(row.percentage);\n\n        let qty_in_grams = (i < child.length - 1) ?\n            total_required * (perc / total_percentage) :\n            total_required - sum_qty; // last row gets remaining to match total exactly\n\n        // Convert to lbs\n        let qty_in_lbs = qty_in_grams / 453.59237;\n        qty_in_lbs = parseFloat(qty_in_lbs.toFixed(2));\n\n        frappe.model.set_value(row.doctype, row.name, \"total_qty\", qty_in_lbs);\n\n        sum_qty += qty_in_grams;\n    }\n\n    frm.refresh_field(\"multiple_colour_ratio\");\n}\n\n// Trigger when elastic_percentage changes\nfrappe.ui.form.on(\"Elastic Details\", {\n    elastic_percentage(frm, cdt, cdn) {\n        calculate_elastic_total(frm, cdt, cdn);\n    }\n});\n\n// Trigger when parent sweater_quantity changes\nfrappe.ui.form.on(\"Order Sheet Entry\", {\n    sweater_quantity(frm) {\n        if(frm.doc.elastic_details) {\n            frm.doc.elastic_details.forEach(row => {\n                calculate_elastic_total(frm, row.doctype, row.name);\n            });\n        }\n    }\n});\n\nfunction calculate_elastic_total(frm, cdt, cdn) {\n    let row = frappe.get_doc(cdt, cdn);\n\n    let parent_qty = flt(frm.doc.sweater_quantity || 0);   // Sweater qty\n    let elastic_qty = flt(row.elastic_qty || 0);          // Per pcs elastic qty\n    let percentage = flt(row.elastic_percentage || 0);    // Wastage %\n\n    // Total in grams including wastage\n    let total_grams = parent_qty * elastic_qty;\n\n    if (percentage > 0) {\n        total_grams += total_grams * (percentage / 100);\n    }\n\n    // Convert grams to pounds\n    let total_pounds = total_grams / 453.59237;\n\n    // Round: if decimal >= 0.5 â†’ round up\n    total_pounds = Math.round(total_pounds);\n\n    // Add \" Pound\" next to the number\n    let display_value = total_pounds + \" Pound\";\n\n    // Set value in child table\n    frappe.model.set_value(cdt, cdn, \"total_quantity\", display_value);\n\n    // Refresh child table\n    frm.refresh_field(\"elastic_details\");\n}\n\n\n// function calculate_elastic_total(frm, cdt, cdn) {\n//     let row = frappe.get_doc(cdt, cdn);\n\n//     let parent_qty = flt(frm.doc.sweater_quantity || 0);   // Sweater qty\n//     let elastic_qty = flt(row.elastic_qty || 0);          // Per pcs elastic qty\n//     let percentage = flt(row.elastic_percentage || 0);    // Wastage %\n\n//     // Total in grams including wastage\n//     let total_grams = parent_qty * elastic_qty;\n\n//     if (percentage > 0) {\n//         total_grams += total_grams * (percentage / 100);\n//     }\n\n//     // Convert grams to lbs\n//     let total_lbs = total_grams / 453.59237;\n\n//     // Set value in child table\n//     frappe.model.set_value(cdt, cdn, \"total_quantity\", total_lbs);\n\n//     // Refresh child table\n//     frm.refresh_field(\"elastic_details\");\n// }\n\n\nfrappe.ui.form.on('Order Sheet Trim Detail', {\n    // Trigger when any of these fields change\n    consumption: calculate_total_trim,\n    quantity: calculate_total_trim,\n    wastage: calculate_total_trim\n});\n\nfunction calculate_total_trim(frm, cdt, cdn) {\n    let row = frappe.get_doc(cdt, cdn);\n\n    let consumption = parseFloat(row.consumption || 0);\n    let quantity = parseFloat(row.quantity || 0);\n    let wastage = parseFloat(row.wastage || 0);\n\n    // Calculate total trim required for this row\n    row.total_trim_required = (consumption * quantity) * (1 + wastage / 100);\n\n    // Refresh the child table field\n    frm.refresh_field('trim_details');\n\n    // Now calculate grand total for all rows\n    let grand_total = 0;\n    frm.doc.trim_details.forEach(r => {\n        grand_total += parseFloat(r.total_trim_required || 0);\n    });\n\n    // Set the parent field\n    frm.set_value('total_button_required', grand_total);\n}\n\n\n\n",
  "view": "Form"
 }
]