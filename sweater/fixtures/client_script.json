[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset",
  "enabled": 1,
  "modified": "2025-07-29 15:27:44.006534",
  "module": null,
  "name": "ASSET CUSTONIAN FIELD FULL NAME",
  "script": "frappe.ui.form.on('Asset', {\r\n    custodian: function(frm) {\r\n        if (frm.doc.custodian) {\r\n            frappe.call({\r\n                method: \"frappe.client.get\",\r\n                args: {\r\n                    doctype: \"Employee\",\r\n                    name: frm.doc.custodian\r\n                },\r\n                callback: function(r) {\r\n                    if (r.message) {\r\n                        let emp = r.message;\r\n                        let display = `${emp.employee_number || ''} - ${emp.employee_name || emp.employee || ''}`;\r\n                        frm.set_value('custodian_details', display);\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            frm.set_value('custodian_details', '');\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Daily Sample Request",
  "enabled": 1,
  "modified": "2025-11-13 01:21:50.614833",
  "module": "Sweater",
  "name": "AUTO FILL THE PROCESS TYPE",
  "script": "frappe.ui.form.on('Daily Sample Request', {\n    refresh(frm) {\n        // Add button on form\n        frm.add_custom_button('Create Sample Work Order', () => {\n            if (!frm.doc.name) {\n                frappe.msgprint(__('Please save the Daily Sample Request first.'));\n                return;\n            }\n\n            // Create new Sample Work Order with link field prefilled\n            frappe.new_doc('Sample Work Order', {\n                fetch_daily_sample_request: frm.doc.name\n            });\n        }, __('Actions')); // optional group label for better UI\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sample Work Order",
  "enabled": 1,
  "modified": "2025-12-14 09:56:06.132744",
  "module": null,
  "name": "AUTO FILL PROCESS TYPE",
  "script": "// ===============================\n// SAMPLE WORK ORDER - CLIENT SCRIPT\n// ===============================\n\n// Central map (use one source only)\nconst processTypeMap = {\n    \"Design\": \"Pre-Production\",\n    \"Program\": \"Pre-Production\",\n    \"Knitting\": \"Production\",\n    \"Knitting Manual\": \"Production\",\n    \"Linking\": \"Production\",\n    \"Mending\": \"Production\",\n    \"Wash\": \"Post-Production\",\n    \"Print\": \"Post-Production\",\n    \"Iron\": \"Post-Production\",\n    \"Sewing\": \"Post-Production\",\n    \"Zip / Button\": \"Post-Production\",\n    \"Finishing\": \"Post-Production\"\n};\n\n\n// ===============================\n// PARENT DOCTYPE\n// ===============================\nfrappe.ui.form.on('Sample Work Order', {\n\n    // When form loads (existing document)\n    onload(frm) {\n        if (!frm.doc.workstation_details) return;\n\n        frm.doc.workstation_details.forEach(row => {\n            if (row.process_name && !row.process_type) {\n                frappe.model.set_value(\n                    row.doctype,\n                    row.name,\n                    \"process_type\",\n                    processTypeMap[row.process_name] || \"\"\n                );\n            }\n        });\n    },\n\n    // Extra safety before save\n    before_save(frm) {\n        frm.doc.workstation_details.forEach(row => {\n            if (row.process_name) {\n                frappe.model.set_value(\n                    row.doctype,\n                    row.name,\n                    \"process_type\",\n                    processTypeMap[row.process_name] || \"\"\n                );\n            }\n        });\n    }\n});\n\n\n// ===============================\n// CHILD TABLE\n// ===============================\nfrappe.ui.form.on('Workstation Details', {\n\n    // When process name changes\n    process_name(frm, cdt, cdn) {\n        const row = locals[cdt][cdn];\n\n        if (row.process_name) {\n            frappe.model.set_value(\n                cdt,\n                cdn,\n                \"process_type\",\n                processTypeMap[row.process_name] || \"\"\n            );\n        } else {\n            frappe.model.set_value(\n                cdt,\n                cdn,\n                \"process_type\",\n                \"\"\n            );\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Order Sheet Entry",
  "enabled": 1,
  "modified": "2026-02-12 19:48:07.230363",
  "module": null,
  "name": "ORDER AUTOFILL CLIENT SCRIPT WITH AUTO SYNC TRIM VALUE",
  "script": "// Order Sheet Entry: অটো-সিঙ্ক এবং ক্যালকুলেশন ডকুমেন্টেশন\n// এই কোডটির মূল উদ্দেশ্য হলো Main Quantity Grid-এর সাথে অন্যান্য সব চাইল্ড টেবিল (যেমন: Yarn, Trims, Elastic) অটোমেটিক আপডেট করা এবং সবকিছুর নিখুঁত হিসাব বের করা।\n\n// ১. অটো-সিঙ্ক টেবিল লিস্ট (SYNC_TABLES)\n\n// কোডের শুরুতে একটি লিস্ট দেওয়া আছে যেখানে ১৪টি চাইল্ড টেবিলের নাম আছে (যেমন: trim_details, yarn_details, price_tag_sticker_quantity ইত্যাদি)। মেইন গ্রিডে কোনো সাইজ বা কোয়ান্টিটি পরিবর্তন করলে এই টেবিলগুলোতে অটোমেটিক ডাটা চলে যাবে।\n\n// ২. ডাটা সিঙ্ক্রোনাইজেশন (sync_qty_to_tables)\n\n// এটি কোডের সবচেয়ে গুরুত্বপূর্ণ অংশ। এটি যা করে:\n\n// অটো-অ্যাড: মেইন গ্রিডে (qty_details) আপনি যখন নতুন কোনো Size যোগ করবেন, সেটি অটোমেটিক অন্য সব টেবিলে যোগ হয়ে যাবে।\n\n// ভ্যালু সিঙ্ক: মেইন গ্রিডের কোয়ান্টিটি পরিবর্তন করলে অন্য টেবিলের কোয়ান্টিটিও আপডেট হবে।\n\n// অটো-রিমুভ: মেইন গ্রিড থেকে কোনো সাইজ ডিলিট করে দিলে অন্য সব টেবিল থেকেও সেই সাইজের রো (Row) মুছে যাবে।\n\n// ৩. স্মার্ট ক্যালকুলেশন (run_smart_calc)\n\n// এই ফাংশনটি Trims এবং Accessories-এর প্রয়োজনীয় পরিমাণ হিসাব করে:\n\n// Sewing Thread: সূত্র: (Qty / Consumption) * Wastage.\n\n// Buttons: সূত্র: (Cons * Qty * Wastage) / 1728 (ডজন বা গ্রস ক্যালকুলেশন)।\n\n// General Trims: অন্যান্য সব ট্রিমসের জন্য সাধারণ গুণফল এবং ওয়েস্টেজ যোগ করা হয়।\n\n// ৪. স্পেশাল ক্যালকুলেশন (Yarn & Elastic)\n\n// Yarn Total: সুতার ওজনকে গ্রাম থেকে Lbs (পাউন্ড) এ কনভার্ট করে (১ পাউন্ড = ৪৫৩.৫৯ গ্রাম)।\n\n// Elastic Total: এলাস্টিকের ওজনকে গ্রাম থেকে পাউন্ডে রূপান্তর করে এবং শেষে \"Lbs\" লেখাটি যোগ করে।\n\n// ৫. ফাইনাল টোটাল (run_all_calculations)\n\n// এই ফাংশনটি পুরো ফর্মের সব হিসাব একত্র করে:\n\n// পুরো অর্ডারের মোট সোয়েটার কোয়ান্টিটি কত তা বের করে।\n\n// Yarn, Thread এবং Button-এর জন্য আলাদা আলাদা গ্র্যান্ড টোটাল (Grand Total) ফিল্ড আপডেট করে।\n\n// কিভাবে এটি কাজ শুরু করে?\n\n// ১. যখন আপনি ফর্মটি Open (Refresh) করবেন।\n\n// ২. যখন মেইন গ্রিডে কোনো Row যোগ বা বিয়োগ করবেন।\n\n// ৩. যখন মেইন গ্রিডে কোনো Quantity বা Size পরিবর্তন করবেন।\n\n// ৪. যখন ফর্মটি Save বা Validate করবেন।\n\n// এক কথায়: এই কোডটি আপনার ম্যানুয়াল কাজের কষ্ট কমিয়ে দেয় এবং সব টেবিলের মধ্যে সাইজ ও কোয়ান্টিটির মিল নিশ্চিত করে।\n\n\n\n// // =========================================================\n// // Order Sheet Entry – Absolute Auto-Sync & Multi-Logic Calc\n// // =========================================================\n\n// const SYNC_TABLES = [\n//     \"trim_details\",               \n//     \"sewing_thread_booking\",      \n//     \"main_label_with_size_details\",\n//     \"price_tag_quantity\",\n//     \"price_tag_sticker_quantity\",\n//     \"hand_tag_details\",\n//     \"poly_details\",\n//     \"blister_details\",\n//     \"cartoon_details\",\n//     \"gum_tape_details\",\n//     \"zipper_booking\",\n//     \"button_poly_details\",        // Confirmed Field Name\n//     \"yarn_details\",\n//     \"elastic_details\"             \n// ];\n\n// frappe.ui.form.on(\"Order Sheet Entry\", {\n//     refresh(frm) { run_all_calculations(frm); },\n//     validate(frm) { run_all_calculations(frm); },\n//     before_save(frm) { run_all_calculations(frm); },\n//     qty_details_add(frm) { sync_qty_to_tables(frm); },\n//     qty_details_remove(frm) { sync_qty_to_tables(frm); }\n// });\n\n// frappe.ui.form.on(\"Order Sheet Qty Detail\", {\n//     qty: function(frm) { sync_qty_to_tables(frm); },\n//     size: function(frm) { sync_qty_to_tables(frm); }\n// });\n\n// // 2. Attach Listeners to Child Tables\n// SYNC_TABLES.forEach(table => {\n//     frappe.ui.form.on(table, {\n//         consumption: (frm, cdt, cdn) => run_smart_calc(frm, cdt, cdn),\n//         wastage: (frm, cdt, cdn) => run_smart_calc(frm, cdt, cdn),\n//         quantity: (frm, cdt, cdn) => run_smart_calc(frm, cdt, cdn)\n//     });\n// });\n\n// // 3. Main Sync Function\n// function sync_qty_to_tables(frm) {\n//     let qty_rows = frm.doc.qty_details || [];\n//     let processed_sizes = qty_rows.map(r => r.size).filter(Boolean);\n\n//     SYNC_TABLES.forEach(table_name => {\n//         if (!frm.get_field(table_name)) return;\n        \n//         qty_rows.forEach(qty_row => {\n//             if (!qty_row.size) return;\n//             let row = (frm.doc[table_name] || []).find(r => r.size === qty_row.size);\n//             if (!row) {\n//                 row = frm.add_child(table_name);\n//                 row.size = qty_row.size;\n//             }\n//             frappe.model.set_value(row.doctype, row.name, \"quantity\", flt(qty_row.qty));\n//         });\n\n//         let table_rows = frm.doc[table_name] || [];\n//         for (let i = table_rows.length - 1; i >= 0; i--) {\n//             if (!processed_sizes.includes(table_rows[i].size)) {\n//                 table_rows.splice(i, 1);\n//             }\n//         }\n//         frm.refresh_field(table_name);\n//     });\n\n//     run_all_calculations(frm);\n// }\n\n// // 4. Smart Calculation Logic\n// function run_smart_calc(frm, cdt, cdn) {\n//     let row = frappe.get_doc(cdt, cdn);\n//     let qty = flt(row.quantity);\n//     let cons = flt(row.consumption);\n//     let wast = flt(row.wastage);\n//     let result = 0;\n\n//     if (cons > 0) {\n//         if (row.parentfield === \"sewing_thread_booking\") {\n//             result = (qty / cons) * (1 + wast / 100);\n//         } \n//         else if (row.parentfield === \"trim_details\") {\n//             result = (cons * qty * (1 + wast / 100)) / 1728;\n//         } \n//         else if (row.parentfield === \"elastic_details\") {\n//             // Gram to Lbs conversion\n//             let grams = (qty * cons) * (1 + wast / 100);\n//             result = grams / 453.59237; \n//         }\n//         else if (row.parentfield !== \"yarn_details\") {\n//             // Standard Logic for Button Poly and others\n//             result = (qty * cons) * (1 + wast / 100);\n//         }\n//     }\n\n//     if (row.parentfield !== \"yarn_details\") {\n//         frappe.model.set_value(cdt, cdn, \"total_trim_required\", flt(result, 3));\n//     }\n// }\n\n// // 5. Yarn Logic (Gram to Lbs)\n// function calculate_yarn_totals(frm) {\n//     let running_total_lbs = 0;\n//     (frm.doc.yarn_details || []).forEach(row => {\n//         let row_grams = (flt(row.consumption) * flt(row.quantity)) * (1 + flt(row.wastage) / 100);\n//         let row_lbs = row_grams / 453.59237;\n//         frappe.model.set_value(row.doctype, row.name, \"total_yarn\", flt(row_lbs, 3));\n//         running_total_lbs += row_lbs;\n//     });\n//     frm.set_value(\"total_required_yarn\", flt(running_total_lbs, 3));\n// }\n\n// // 6. Final Aggregate Totals\n// function run_all_calculations(frm) {\n//     let total_sweater_qty = (frm.doc.qty_details || []).reduce((sum, r) => sum + flt(r.qty), 0);\n//     frm.set_value(\"sweater_quantity\", total_sweater_qty);\n\n//     calculate_yarn_totals(frm);\n\n//     // Refresh row calculations\n//     SYNC_TABLES.forEach(table => {\n//         if (frm.doc[table] && table !== \"yarn_details\") {\n//             frm.doc[table].forEach(r => run_smart_calc(frm, r.doctype, r.name));\n//         }\n//     });\n\n//     // Parent Field Updates\n//     const update_total = (table, field) => {\n//         let total = (frm.doc[table] || []).reduce((sum, r) => sum + flt(r.total_trim_required), 0);\n//         frm.set_value(field, flt(total, 3));\n//     };\n\n//     update_total('sewing_thread_booking', 'total_sewing_thred_required');\n//     update_total('trim_details', 'total_button_required');\n//     update_total('main_label_with_size_details', 'total_main_label_with_size_required');\n//     update_total('elastic_details', 'total_elastic_required');\n//     update_total('button_poly_details', 'total_button_poly_required');\n// }\n\n// =========================================================\n// Order Sheet Entry – Absolute Auto-Sync & Multi-Logic Calc\n// =========================================================\n\nconst SYNC_TABLES = [\n    \"trim_details\",               \n    \"sewing_thread_booking\",      \n    \"main_label_with_size_details\",\n    \"price_tag_quantity\",\n    \"price_tag_sticker_quantity\",\n    \"hand_tag_details\",\n    \"poly_details\",\n    \"blister_details\",\n    \"cartoon_details\",\n    \"gum_tape_details\",\n    \"zipper_booking\",\n    \"button_poly_details\",        \n    \"main_label_details\",         // Added Main Label Booking\n    \"yarn_details\",\n    \"elastic_details\"             \n];\n\nfrappe.ui.form.on(\"Order Sheet Entry\", {\n    refresh(frm) { run_all_calculations(frm); },\n    validate(frm) { run_all_calculations(frm); },\n    before_save(frm) { run_all_calculations(frm); },\n    qty_details_add(frm) { sync_qty_to_tables(frm); },\n    qty_details_remove(frm) { sync_qty_to_tables(frm); }\n});\n\nfrappe.ui.form.on(\"Order Sheet Qty Detail\", {\n    qty: function(frm) { sync_qty_to_tables(frm); },\n    size: function(frm) { sync_qty_to_tables(frm); }\n});\n\n// 2. Attach Listeners to Child Tables\nSYNC_TABLES.forEach(table => {\n    frappe.ui.form.on(table, {\n        consumption: (frm, cdt, cdn) => run_smart_calc(frm, cdt, cdn),\n        wastage: (frm, cdt, cdn) => run_smart_calc(frm, cdt, cdn),\n        quantity: (frm, cdt, cdn) => run_smart_calc(frm, cdt, cdn)\n    });\n});\n\n// 3. Main Sync Function\nfunction sync_qty_to_tables(frm) {\n    let qty_rows = frm.doc.qty_details || [];\n    let processed_sizes = qty_rows.map(r => r.size).filter(Boolean);\n\n    SYNC_TABLES.forEach(table_name => {\n        if (!frm.get_field(table_name)) return;\n        \n        qty_rows.forEach(qty_row => {\n            if (!qty_row.size) return;\n            let row = (frm.doc[table_name] || []).find(r => r.size === qty_row.size);\n            if (!row) {\n                row = frm.add_child(table_name);\n                row.size = qty_row.size;\n            }\n            frappe.model.set_value(row.doctype, row.name, \"quantity\", flt(qty_row.qty));\n        });\n\n        let table_rows = frm.doc[table_name] || [];\n        for (let i = table_rows.length - 1; i >= 0; i--) {\n            if (!processed_sizes.includes(table_rows[i].size)) {\n                table_rows.splice(i, 1);\n            }\n        }\n        frm.refresh_field(table_name);\n    });\n\n    run_all_calculations(frm);\n}\n\n// 4. Smart Calculation Logic\nfunction run_smart_calc(frm, cdt, cdn) {\n    let row = frappe.get_doc(cdt, cdn);\n    let qty = flt(row.quantity);\n    let cons = flt(row.consumption);\n    let wast = flt(row.wastage);\n    let result = 0;\n\n    if (cons > 0) {\n        if (row.parentfield === \"sewing_thread_booking\") {\n            result = (qty / cons) * (1 + wast / 100);\n        } \n        else if (row.parentfield === \"trim_details\") {\n            result = (cons * qty * (1 + wast / 100)) / 1728;\n        } \n        else if (row.parentfield === \"elastic_details\") {\n            let grams = (qty * cons) * (1 + wast / 100);\n            result = grams / 453.59237; \n        }\n        else if (row.parentfield !== \"yarn_details\") {\n            // Standard Logic for Labels, Zippers, and Button Poly\n            result = (qty * cons) * (1 + wast / 100);\n        }\n    }\n\n    if (row.parentfield !== \"yarn_details\") {\n        frappe.model.set_value(cdt, cdn, \"total_trim_required\", flt(result, 3));\n    }\n}\n\n// 5. Yarn Logic (Gram to Lbs)\nfunction calculate_yarn_totals(frm) {\n    let running_total_lbs = 0;\n    (frm.doc.yarn_details || []).forEach(row => {\n        let row_grams = (flt(row.consumption) * flt(row.quantity)) * (1 + flt(row.wastage) / 100);\n        let row_lbs = row_grams / 453.59237;\n        frappe.model.set_value(row.doctype, row.name, \"total_yarn\", flt(row_lbs, 3));\n        running_total_lbs += row_lbs;\n    });\n    frm.set_value(\"total_required_yarn\", flt(running_total_lbs, 3));\n}\n\n// 6. Final Aggregate Totals\nfunction run_all_calculations(frm) {\n    let total_sweater_qty = (frm.doc.qty_details || []).reduce((sum, r) => sum + flt(r.qty), 0);\n    frm.set_value(\"sweater_quantity\", total_sweater_qty);\n\n    calculate_yarn_totals(frm);\n\n    SYNC_TABLES.forEach(table => {\n        if (frm.doc[table] && table !== \"yarn_details\") {\n            frm.doc[table].forEach(r => run_smart_calc(frm, r.doctype, r.name));\n        }\n    });\n\n    const update_total = (table, field) => {\n        if (!frm.get_field(field)) return;\n        let total = (frm.doc[table] || []).reduce((sum, r) => sum + flt(r.total_trim_required), 0);\n        frm.set_value(field, flt(total, 3));\n    };\n\n    update_total('sewing_thread_booking', 'total_sewing_thred_required');\n    update_total('trim_details', 'total_button_required');\n    update_total('main_label_with_size_details', 'total_main_label_with_size_required');\n    update_total('elastic_details', 'total_elastic_required');\n    update_total('button_poly_details', 'total_button_poly_required');\n    update_total('zipper_booking', 'total_zipper_required');\n    \n    // Main Label Grand Total\n    update_total('main_label_details', 'total_main_label_required');\n}\n",
  "view": "Form"
 }
]