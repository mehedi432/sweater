[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Asset",
  "enabled": 1,
  "modified": "2025-07-29 15:27:44.006534",
  "module": null,
  "name": "ASSET CUSTONIAN FIELD FULL NAME",
  "script": "frappe.ui.form.on('Asset', {\r\n    custodian: function(frm) {\r\n        if (frm.doc.custodian) {\r\n            frappe.call({\r\n                method: \"frappe.client.get\",\r\n                args: {\r\n                    doctype: \"Employee\",\r\n                    name: frm.doc.custodian\r\n                },\r\n                callback: function(r) {\r\n                    if (r.message) {\r\n                        let emp = r.message;\r\n                        let display = `${emp.employee_number || ''} - ${emp.employee_name || emp.employee || ''}`;\r\n                        frm.set_value('custodian_details', display);\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n            frm.set_value('custodian_details', '');\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Daily Sample Request",
  "enabled": 1,
  "modified": "2025-11-13 01:21:50.614833",
  "module": "Sweater",
  "name": "AUTO FILL THE PROCESS TYPE",
  "script": "frappe.ui.form.on('Daily Sample Request', {\n    refresh(frm) {\n        // Add button on form\n        frm.add_custom_button('Create Sample Work Order', () => {\n            if (!frm.doc.name) {\n                frappe.msgprint(__('Please save the Daily Sample Request first.'));\n                return;\n            }\n\n            // Create new Sample Work Order with link field prefilled\n            frappe.new_doc('Sample Work Order', {\n                fetch_daily_sample_request: frm.doc.name\n            });\n        }, __('Actions')); // optional group label for better UI\n    }\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sample Work Order",
  "enabled": 1,
  "modified": "2025-12-14 09:56:06.132744",
  "module": null,
  "name": "AUTO FILL PROCESS TYPE",
  "script": "// ===============================\n// SAMPLE WORK ORDER - CLIENT SCRIPT\n// ===============================\n\n// Central map (use one source only)\nconst processTypeMap = {\n    \"Design\": \"Pre-Production\",\n    \"Program\": \"Pre-Production\",\n    \"Knitting\": \"Production\",\n    \"Knitting Manual\": \"Production\",\n    \"Linking\": \"Production\",\n    \"Mending\": \"Production\",\n    \"Wash\": \"Post-Production\",\n    \"Print\": \"Post-Production\",\n    \"Iron\": \"Post-Production\",\n    \"Sewing\": \"Post-Production\",\n    \"Zip / Button\": \"Post-Production\",\n    \"Finishing\": \"Post-Production\"\n};\n\n\n// ===============================\n// PARENT DOCTYPE\n// ===============================\nfrappe.ui.form.on('Sample Work Order', {\n\n    // When form loads (existing document)\n    onload(frm) {\n        if (!frm.doc.workstation_details) return;\n\n        frm.doc.workstation_details.forEach(row => {\n            if (row.process_name && !row.process_type) {\n                frappe.model.set_value(\n                    row.doctype,\n                    row.name,\n                    \"process_type\",\n                    processTypeMap[row.process_name] || \"\"\n                );\n            }\n        });\n    },\n\n    // Extra safety before save\n    before_save(frm) {\n        frm.doc.workstation_details.forEach(row => {\n            if (row.process_name) {\n                frappe.model.set_value(\n                    row.doctype,\n                    row.name,\n                    \"process_type\",\n                    processTypeMap[row.process_name] || \"\"\n                );\n            }\n        });\n    }\n});\n\n\n// ===============================\n// CHILD TABLE\n// ===============================\nfrappe.ui.form.on('Workstation Details', {\n\n    // When process name changes\n    process_name(frm, cdt, cdn) {\n        const row = locals[cdt][cdn];\n\n        if (row.process_name) {\n            frappe.model.set_value(\n                cdt,\n                cdn,\n                \"process_type\",\n                processTypeMap[row.process_name] || \"\"\n            );\n        } else {\n            frappe.model.set_value(\n                cdt,\n                cdn,\n                \"process_type\",\n                \"\"\n            );\n        }\n    }\n});\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Order Sheet Entry",
  "enabled": 0,
  "modified": "2026-02-02 21:48:37.822988",
  "module": null,
  "name": "ORDER SHEET AUTOFILL NEW",
  "script": "// =============================\n// Order Sheet Entry – Client Script (Cleaned & De-duplicated)\n// =============================\n\n// -------- Parent Doctype --------\nfrappe.ui.form.on(\"Order Sheet Entry\", {\n    refresh(frm) {\n        calculate_totals(frm);\n    },\n\n    qty_details_add(frm) {\n        sync_qty_to_yarn(frm);\n    },\n\n    qty_details_remove(frm) {\n        sync_qty_to_yarn(frm);\n    },\n\n    sweater_quantity(frm) {\n        // Recalculate elastic totals when sweater qty changes\n        (frm.doc.elastic_details || []).forEach(row => {\n            calculate_elastic_total(frm, row.doctype, row.name);\n        });\n    },\n\n    total_required_yarn(frm) {\n        calculate_colour_totals(frm);\n    }\n});\n\n// -------- Qty Child Table --------\nfrappe.ui.form.on(\"Order Sheet Qty Detail\", {\n    qty(frm) {\n        sync_qty_to_yarn(frm);\n    },\n    size(frm) {\n        sync_qty_to_yarn(frm);\n    }\n});\n\n// -------- Yarn Sync Logic --------\nfunction sync_qty_to_yarn(frm) {\n    let qty_rows = frm.doc.qty_details || [];\n    let yarn_rows = frm.doc.yarn_details || [];\n\n    let processed_sizes = [];\n\n    qty_rows.forEach(qty_row => {\n        let yarn_row = yarn_rows.find(r => r.size === qty_row.size);\n\n        if (!yarn_row) {\n            yarn_row = frm.add_child(\"yarn_details\");\n            yarn_row.size = qty_row.size;\n        }\n\n        processed_sizes.push(qty_row.size);\n\n        frappe.model.set_value(yarn_row.doctype, yarn_row.name, \"quantity\", flt(qty_row.qty));\n\n        let consumption = flt(yarn_row.consumption_per_pcs || 0);\n        let wastage = flt(yarn_row.wastage || 0);\n\n        let total = (consumption * flt(qty_row.qty)) * (1 + wastage / 100);\n        frappe.model.set_value(yarn_row.doctype, yarn_row.name, \"total_yarn\", total);\n    });\n\n    // Remove orphan yarn rows\n    yarn_rows.forEach(row => {\n        if (!processed_sizes.includes(row.size)) {\n            frappe.model.delete_doc(row.doctype, row.name);\n        }\n    });\n\n    frm.refresh_field(\"yarn_details\");\n    calculate_totals(frm);\n}\n\n// -------- Parent Totals --------\nfunction calculate_totals(frm) {\n    let total_yarn = 0;\n    let total_qty = 0;\n\n    (frm.doc.yarn_details || []).forEach(row => {\n        total_yarn += flt(row.total_yarn);\n        total_qty += flt(row.quantity);\n    });\n\n    frm.set_value(\"total_required_yarn\", total_yarn);\n    frm.set_value(\"sweater_quantity\", total_qty);\n}\n\n// -------- Multiple Colour Ratio --------\nfrappe.ui.form.on(\"Multiple Colour Ratio\", {\n    percentage(frm) {\n        calculate_colour_totals(frm);\n    },\n    weight(frm) {\n        calculate_colour_totals(frm);\n    }\n});\n\nfunction calculate_colour_totals(frm) {\n    let rows = frm.doc.multiple_colour_ratio || [];\n    if (!rows.length) return;\n\n    let total_required = flt(frm.doc.total_required_yarn);\n    let total_percentage = rows.reduce((t, r) => t + flt(r.percentage), 0);\n\n    let used_grams = 0;\n\n    rows.forEach((row, index) => {\n        let grams = (index < rows.length - 1)\n            ? total_required * (flt(row.percentage) / total_percentage)\n            : total_required - used_grams;\n\n        used_grams += grams;\n\n        let lbs = parseFloat((grams / 453.59237).toFixed(2));\n        frappe.model.set_value(row.doctype, row.name, \"total_qty\", lbs);\n    });\n\n    frm.refresh_field(\"multiple_colour_ratio\");\n}\n\n// -------- Elastic Details --------\nfrappe.ui.form.on(\"Elastic Details\", {\n    elastic_percentage(frm, cdt, cdn) {\n        calculate_elastic_total(frm, cdt, cdn);\n    }\n});\n\nfunction calculate_elastic_total(frm, cdt, cdn) {\n    let row = frappe.get_doc(cdt, cdn);\n\n    let parent_qty = flt(frm.doc.sweater_quantity);\n    let elastic_qty = flt(row.elastic_qty);\n    let wastage = flt(row.elastic_percentage);\n\n    let grams = parent_qty * elastic_qty;\n    grams += grams * (wastage / 100);\n\n    let pounds = Math.round(grams / 453.59237);\n    frappe.model.set_value(cdt, cdn, \"total_quantity\", `${pounds} Pound`);\n\n    frm.refresh_field(\"elastic_details\");\n}\n\nfrappe.ui.form.on('Order Sheet Trim Detail', {\n    consumption: calculate_total_trim,\n    quantity: calculate_total_trim,\n    wastage: calculate_total_trim\n});\n\nfunction calculate_total_trim(frm, cdt, cdn) {\n    let row = frappe.get_doc(cdt, cdn);\n\n    // 1. Calculate total pieces including wastage\n    let pieces = (flt(row.consumption) * flt(row.quantity)) * (1 + flt(row.wastage) / 100);\n    \n    // 2. Convert pieces to GG (divide by 1728)\n    row.total_trim_required = pieces / 1728;\n\n    frm.refresh_field('trim_details');\n\n    // 3. Sum all rows for the grand total\n    let grand_total = (frm.doc.trim_details || [])\n        .reduce((t, r) => t + flt(r.total_trim_required), 0);\n\n    frm.set_value('total_button_required', grand_total);\n}\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Order Sheet Entry",
  "enabled": 1,
  "modified": "2026-02-02 21:53:41.277966",
  "module": null,
  "name": "ORDER AUTOFILL CLIENT SCRIPT WITH AUTO SYNC TRIM VALUE",
  "script": "// =========================================================\n// Order Sheet Entry – Full Unified Client Script\n// =========================================================\n\nfrappe.ui.form.on(\"Order Sheet Entry\", {\n    refresh(frm) {\n        calculate_totals(frm);\n    },\n\n    qty_details_add(frm) {\n        sync_qty_to_tables(frm);\n    },\n\n    qty_details_remove(frm) {\n        sync_qty_to_tables(frm);\n    },\n\n    sweater_quantity(frm) {\n        // Recalculate elastic totals when sweater qty changes\n        (frm.doc.elastic_details || []).forEach(row => {\n            calculate_elastic_total(frm, row.doctype, row.name);\n        });\n    },\n\n    total_required_yarn(frm) {\n        calculate_colour_totals(frm);\n    }\n});\n\n// -------- Main Trigger: Qty Child Table --------\nfrappe.ui.form.on(\"Order Sheet Qty Detail\", {\n    qty(frm) {\n        sync_qty_to_tables(frm);\n    },\n    size(frm) {\n        sync_qty_to_tables(frm);\n    }\n});\n\n// -------- Master Sync Logic (Autofill Yarn & Trims) --------\nfunction sync_qty_to_tables(frm) {\n    let qty_rows = frm.doc.qty_details || [];\n    let yarn_rows = frm.doc.yarn_details || [];\n    let trim_rows = frm.doc.trim_details || [];\n    let processed_sizes = [];\n\n    qty_rows.forEach(qty_row => {\n        if (!qty_row.size) return;\n        processed_sizes.push(qty_row.size);\n\n        // --- 1. SYNC YARN SECTION ---\n        let yarn_row = yarn_rows.find(r => r.size === qty_row.size);\n        if (!yarn_row) {\n            yarn_row = frm.add_child(\"yarn_details\");\n            yarn_row.size = qty_row.size;\n        }\n        frappe.model.set_value(yarn_row.doctype, yarn_row.name, \"quantity\", flt(qty_row.qty));\n        \n        // Internal Yarn Calculation\n        let y_cons = flt(yarn_row.consumption_per_pcs || 0);\n        let y_wast = flt(yarn_row.wastage || 0);\n        let y_total = (y_cons * flt(qty_row.qty)) * (1 + y_wast / 100);\n        frappe.model.set_value(yarn_row.doctype, yarn_row.name, \"total_yarn\", y_total);\n\n        // --- 2. SYNC TRIM SECTION ---\n        let trim_row = trim_rows.find(r => r.size === qty_row.size);\n        if (!trim_row) {\n            trim_row = frm.add_child(\"trim_details\");\n            trim_row.size = qty_row.size;\n        }\n        frappe.model.set_value(trim_row.doctype, trim_row.name, \"quantity\", flt(qty_row.qty));\n        \n        // Internal Trim Calculation (GG Conversion)\n        run_trim_calc(frm, trim_row.doctype, trim_row.name);\n    });\n\n    // --- 3. REMOVE ORPHANS (Cleanup deleted sizes) ---\n    frm.doc.yarn_details = (frm.doc.yarn_details || []).filter(r => processed_sizes.includes(r.size));\n    frm.doc.trim_details = (frm.doc.trim_details || []).filter(r => processed_sizes.includes(r.size));\n\n    frm.refresh_field(\"yarn_details\");\n    frm.refresh_field(\"trim_details\");\n    calculate_totals(frm);\n}\n\n// -------- Trim Calculation Logic --------\nfrappe.ui.form.on('Order Sheet Trim Detail', {\n    consumption: (frm, cdt, cdn) => run_trim_calc(frm, cdt, cdn),\n    wastage: (frm, cdt, cdn) => run_trim_calc(frm, cdt, cdn),\n    quantity: (frm, cdt, cdn) => run_trim_calc(frm, cdt, cdn)\n});\n\nfunction run_trim_calc(frm, cdt, cdn) {\n    let row = frappe.get_doc(cdt, cdn);\n    let pieces = (flt(row.consumption) * flt(row.quantity)) * (1 + flt(row.wastage) / 100);\n    let total_gg = pieces / 1728; // Great Gross conversion\n    \n    frappe.model.set_value(cdt, cdn, \"total_trim_required\", total_gg);\n\n    // Update Parent Grand Total\n    let grand_total = (frm.doc.trim_details || []).reduce((t, r) => t + flt(r.total_trim_required), 0);\n    frm.set_value('total_button_required', grand_total);\n}\n\n// -------- Parent Totals (Yarn & Sweater Qty) --------\nfunction calculate_totals(frm) {\n    let total_yarn = 0;\n    let total_qty = 0;\n\n    (frm.doc.yarn_details || []).forEach(row => {\n        total_yarn += flt(row.total_yarn);\n        total_qty += flt(row.quantity);\n    });\n\n    frm.set_value(\"total_required_yarn\", total_yarn);\n    frm.set_value(\"sweater_quantity\", total_qty);\n}\n\n// -------- Multiple Colour Ratio Logic --------\nfrappe.ui.form.on(\"Multiple Colour Ratio\", {\n    percentage(frm) { calculate_colour_totals(frm); },\n    weight(frm) { calculate_colour_totals(frm); }\n});\n\nfunction calculate_colour_totals(frm) {\n    let rows = frm.doc.multiple_colour_ratio || [];\n    if (!rows.length) return;\n\n    let total_required = flt(frm.doc.total_required_yarn);\n    let total_percentage = rows.reduce((t, r) => t + flt(r.percentage), 0);\n    let used_grams = 0;\n\n    rows.forEach((row, index) => {\n        let grams = (index < rows.length - 1)\n            ? total_required * (flt(row.percentage) / (total_percentage || 1))\n            : total_required - used_grams;\n\n        used_grams += grams;\n        let lbs = parseFloat((grams / 453.59237).toFixed(2));\n        frappe.model.set_value(row.doctype, row.name, \"total_qty\", lbs);\n    });\n    frm.refresh_field(\"multiple_colour_ratio\");\n}\n\n// -------- Elastic Details Logic --------\nfrappe.ui.form.on(\"Elastic Details\", {\n    elastic_percentage(frm, cdt, cdn) { calculate_elastic_total(frm, cdt, cdn); },\n    elastic_qty(frm, cdt, cdn) { calculate_elastic_total(frm, cdt, cdn); }\n});\n\nfunction calculate_elastic_total(frm, cdt, cdn) {\n    let row = frappe.get_doc(cdt, cdn);\n    let parent_qty = flt(frm.doc.sweater_quantity);\n    let e_qty = flt(row.elastic_qty);\n    let e_wast = flt(row.elastic_percentage);\n\n    let grams = (parent_qty * e_qty) * (1 + e_wast / 100);\n    let pounds = Math.round(grams / 453.59237);\n    \n    frappe.model.set_value(cdt, cdn, \"total_quantity\", `${pounds} Pound`);\n    frm.refresh_field(\"elastic_details\");\n}",
  "view": "Form"
 }
]